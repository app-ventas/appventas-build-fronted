"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9651],{9651:(z,w,d)=>{d.r(w),d.d(w,{TransactionTypeEditPageModule:()=>K});var h=d(6814),T=d(95),r=d(2912),m=d(7168),u=d(5861),v=d(5083),t=d(5678),y=d(8439);let A=(()=>{class e{onKeyDown(n){[46,8,9,27,13].includes(n.keyCode)||n.keyCode>=48&&n.keyCode<=57||n.keyCode>=96&&n.keyCode<=105||"-"!==n.key&&"ArrowLeft"==n.key||"ArrowRight"==n.key||"Tab"!==n.key?console.log(n.keyCode):n.preventDefault()}static#t=this.\u0275fac=function(i){return new(i||e)};static#n=this.\u0275dir=t.lG2({type:e,selectors:[["","appAllowNegativeInput",""]],hostBindings:function(i,o){1&i&&t.NdJ("keydown",function(c){return o.onKeyDown(c)})}})}return e})();function P(e,l){if(1&e){const n=t.EpF();t.ynx(0),t.TgZ(1,"ion-button",8),t.NdJ("click",function(){t.CHM(n);const o=t.oxw();return t.KtG(o.goToTransactionTypeList())}),t._uU(2," Cancelar "),t.qZA(),t.TgZ(3,"ion-button",9),t.NdJ("click",function(){t.CHM(n);const o=t.oxw();return t.KtG(o.presentSaveTransactionType())}),t._uU(4," Guardar "),t.qZA(),t.BQk()}if(2&e){const n=t.oxw();t.xp6(3),t.Q6J("fill",n.hasChanged?"solid":"outline")}}function Z(e,l){1&e&&(t.TgZ(0,"h6",16),t._uU(1,"Registrar Transacci\xf3n de venta"),t.qZA())}function E(e,l){1&e&&(t.TgZ(0,"h6",16),t._uU(1,"Modificar Transacci\xf3n de venta"),t.qZA())}function S(e,l){if(1&e){const n=t.EpF();t.ynx(0),t.TgZ(1,"ion-col",26),t._uU(2," Categor\xeda: "),t.qZA(),t.TgZ(3,"ion-col",27)(4,"input",28),t.NdJ("input",function(){t.CHM(n);const o=t.oxw(4);return t.KtG(o.changeTransactionName())})("ngModelChange",function(o){t.CHM(n);const a=t.oxw().$implicit;return t.KtG(a.name=o)}),t.qZA()(),t.TgZ(5,"ion-col",26),t._uU(6," Precio: "),t.qZA(),t.TgZ(7,"ion-col",27)(8,"input",29),t.NdJ("input",function(){t.CHM(n);const o=t.oxw(4);return t.KtG(o.changeTransactionName())})("ngModelChange",function(o){t.CHM(n);const a=t.oxw().$implicit;return t.KtG(a.price=o)}),t.qZA()(),t.BQk()}if(2&e){const n=t.oxw().$implicit;t.xp6(4),t.Q6J("ngModel",n.name),t.xp6(4),t.Q6J("ngModel",n.price)}}function N(e,l){if(1&e){const n=t.EpF();t.ynx(0),t.TgZ(1,"ion-col",30)(2,"input",28),t.NdJ("input",function(){t.CHM(n);const o=t.oxw(4);return t.KtG(o.changeTransactionName())})("ngModelChange",function(o){t.CHM(n);const a=t.oxw().$implicit;return t.KtG(a.name=o)}),t.qZA()(),t.TgZ(3,"ion-col",30)(4,"input",31),t.NdJ("input",function(){t.CHM(n);const o=t.oxw(4);return t.KtG(o.changeTransactionName())})("ngModelChange",function(o){t.CHM(n);const a=t.oxw().$implicit;return t.KtG(a.price=o)}),t.qZA()(),t.BQk()}if(2&e){const n=t.oxw().$implicit;t.xp6(2),t.Q6J("ngModel",n.name),t.xp6(2),t.Q6J("ngModel",n.price)}}const J=(e,l)=>({"border-bottom":e,"padding-1":l});function I(e,l){if(1&e&&(t.TgZ(0,"ion-row",25),t.YNc(1,S,9,2,"ng-container",5)(2,N,5,2,"ng-container",5),t.qZA()),2&e){const n=t.oxw(3);t.Q6J("ngClass",t.WLB(3,J,!n.isLandscape,!n.isLandscape)),t.xp6(1),t.Q6J("ngIf",!n.isLandscape),t.xp6(1),t.Q6J("ngIf",n.isLandscape)}}function k(e,l){1&e&&(t.TgZ(0,"ion-row",32)(1,"ion-col",33),t._uU(2,"Agrega una categor\xeda de venta"),t.qZA()())}function Q(e,l){if(1&e){const n=t.EpF();t.TgZ(0,"ion-row")(1,"ion-col",17),t._uU(2," Agregar Categor\xeda "),t.TgZ(3,"ion-button",18),t.NdJ("click",function(){t.CHM(n);const o=t.oxw(2);return t.KtG(o.newCategory())}),t._UZ(4,"ion-icon",19),t.qZA()(),t.TgZ(5,"ion-col",20)(6,"ion-grid",21)(7,"ion-row",22)(8,"ion-col"),t._uU(9,"Categor\xeda"),t.qZA(),t.TgZ(10,"ion-col"),t._uU(11,"Precio"),t.qZA()(),t.YNc(12,I,3,6,"ion-row",23)(13,k,3,0,"ion-row",24),t.qZA()()()}if(2&e){const n=t.oxw(2);t.xp6(12),t.Q6J("ngForOf",n.transactionType.productCatalogs),t.xp6(1),t.Q6J("ngIf",0==(null==n.transactionType.productCatalogs?null:n.transactionType.productCatalogs.length))}}const H=e=>({"ion-text-center":e});function L(e,l){if(1&e){const n=t.EpF();t.TgZ(0,"ion-grid",10),t.YNc(1,Z,2,0,"h6",11)(2,E,2,0,"h6",11),t.TgZ(3,"ion-row")(4,"ion-col",12)(5,"ion-input",13),t.NdJ("ionInput",function(){t.CHM(n);const o=t.oxw();return t.KtG(o.changeTransactionName())})("ngModelChange",function(o){t.CHM(n);const a=t.oxw();return t.KtG(a.transactionType.name=o)}),t.qZA()(),t.TgZ(6,"ion-col",14)(7,"ion-toggle",15),t.NdJ("ngModelChange",function(o){t.CHM(n);const a=t.oxw();return t.KtG(a.showCategory=o)}),t._uU(8,"Mostrar Categor\xedas"),t.qZA()()(),t.YNc(9,Q,14,2,"ion-row",5),t.qZA()}if(2&e){const n=t.oxw();t.xp6(1),t.Q6J("ngIf","Add"==n.action),t.xp6(1),t.Q6J("ngIf","Modify"==n.action),t.xp6(2),t.Q6J("size",n.isLandscape?8:12),t.xp6(1),t.Q6J("ngModel",n.transactionType.name)("clearInput",!0),t.xp6(1),t.Q6J("size",n.isLandscape?4:12)("ngClass",t.VKq(10,H,n.isLandscape)),t.xp6(1),t.Q6J("ngModel",n.showCategory)("checked",n.showCategory),t.xp6(2),t.Q6J("ngIf",n.showCategory)}}const O=[{path:"",component:(()=>{class e{constructor(n,i,o,a,c,g){this.screenSizeService=n,this.dialogService=i,this.storageService=o,this.apiService=a,this.activatedRoute=c,this.redirectService=g,this.action="",this.isLandscape=!1,this.isSmallScreen=!1,this.hasChanged=!1,this.showCategory=!1}ngOnInit(){var n=this;return(0,u.Z)(function*(){n.userAuth=yield n.storageService.getUserAuth(),n.isLandscape=n.screenSizeService.isLandscape,n.isSmallScreen=window.screen.width<=508,n.screenSizeService.isLandscape$.subscribe(i=>{n.isLandscape=i.isLandscape,n.isSmallScreen=i.innerWidth<=508}),n.activatedRoute.queryParams.subscribe(function(){var i=(0,u.Z)(function*(o){let a;if(n.action=o.action,"Add"==n.action)a={id:(new Date).getTime(),product_catalog_ids:[],productCatalogs:[],name:"",state:"A",detail:0,syncRequired:!0,targetType:v.Lm.Credit};else if("Modify"==n.action){const c=o.transactionTypeId;if(c){const g=yield n.storageService.getTransactionTypes(n.userAuth),_=yield n.storageService.getProductCatalogs(n.userAuth);a=g?.find(s=>s.id==c),a&&(a.productCatalogs=_?_.filter(s=>s.transaction_type_id==c):[],n.showCategory=1==a.detail)}}n.transactionType=a});return function(o){return i.apply(this,arguments)}}())})()}newCategory(){const n=(new Date).getTime();this.transactionType&&this.transactionType.productCatalogs?.push({id:n,status:"A",name:"",transaction_type_id:0}),this.hasChanged=!0}presentSaveTransactionType(){var n=this;return(0,u.Z)(function*(){var i;n.hasChanged?n.dialogService.showAlert({header:("Modify"==n.action?"Modificar":"Nueva")+" Transacci\xf3n de Venta",subHeader:"\xbfSeguro que desea  "+("Modify"==n.action?"modificar":"crear ")+" la transacci\xf3n?",buttons:[{text:"Cancelar",cssClass:"alert-button-cancel",role:"cancel",handler:()=>{}},{text:"Crear",cssClass:"alert-success-confirm",handler:(i=(0,u.Z)(function*(){n.saveTransactionType()}),function(){return i.apply(this,arguments)})}]}):(yield n.dialogService.showLoading()).dismiss()})()}saveTransactionType(){var n=this;return(0,u.Z)(function*(){const i=yield n.dialogService.showLoading();if(!n.transactionType)return;n.transactionType.product_catalog_ids=[];const o=n.transactionType.productCatalogs;if(n.transactionType.detail=0,n.transactionType.state="A",o&&o.length>0){n.transactionType.detail=n.showCategory?1:0;for(let c of o)n.transactionType.product_catalog_ids.push(c.id)}const a=yield n.apiService.saveTransactionType([n.transactionType]).catch(c=>{i.dismiss()});if(a){i.dismiss();const c=n.transactionType.id;if(a["saveTransactionType-"+c]){const g=a["saveTransactionType-"+c];let _=g.insert||g.update;if(_){n.transactionType.id=Number(_.id);const s={...n.transactionType};delete s.productCatalogs;const C=n.transactionType.productCatalogs;if(C&&C.length>0){const x=_.productCatalogs;if(x&&s.product_catalog_ids)for(let p of C){const f=x["productCatalog-"+p.id];if(f){const M=p.id;p.id=Number((f.insert?f.insert:f.update).id),p.transaction_type_id=n.transactionType.id;const b=s.product_catalog_ids.findIndex(U=>U==M);-1!=b?s.product_catalog_ids[b]=p.id:s.product_catalog_ids.push(p.id),yield n.storageService.pushProductCatalog(n.userAuth,p,M)}else n.dialogService.showMessage(`Error modificando categor\xeda con c\xf3digo ${p.id}`)}else n.dialogService.showMessage("Error asociando las categor\xedas de producto")}yield n.storageService.pushTransactionTypes(n.userAuth,s,c),n.goToTransactionTypeList();const q=yield n.dialogService.showAlert({subHeader:"Transacci\xf3n de venta "+("Modify"==n.action?"modificada":"creada")+" exit\xf3samente.",buttons:[{text:"Aceptar",cssClass:"alert-success-confirm",role:"cancel",handler:()=>{}}]});setTimeout(()=>{q.dismiss()},2e3)}else n.dialogService.showMessage("No fu\xe9 posible guardar el tipo de transacci\xf3n")}else n.dialogService.showMessage("No fu\xe9 posible guardar el tipo de transacci\xf3n")}else{const c=n.transactionType.productCatalogs,g={...n.transactionType};if(delete g.productCatalogs,yield n.storageService.pushTransactionTypes(n.userAuth,g,g.id),c&&c.length>0)for(let s of c)s.transaction_type_id=n.transactionType.id,yield n.storageService.pushProductCatalog(n.userAuth,s,s.id);n.goToTransactionTypeList(),yield n.dialogService.showAlert({subHeader:"Transacci\xf3n de venta "+("Modify"==n.action?"modificada":"creada")+" exit\xf3samente.",buttons:[{text:"Aceptar",cssClass:"alert-success-confirm",role:"cancel",handler:()=>{}}]},2e3)}})()}changeTransactionName(){this.hasChanged=!0}goToTransactionTypeList(){var n=this;return(0,u.Z)(function*(){n.redirectService.redirectTo("tabs/transaction-type-config")})()}static#t=this.\u0275fac=function(i){return new(i||e)(t.Y36(y.O6),t.Y36(y.xA),t.Y36(y.V1),t.Y36(y.sM),t.Y36(m.gz),t.Y36(y.VH))};static#n=this.\u0275cmp=t.Xpm({type:e,selectors:[["app-transaction-type-edit"]],decls:10,vars:4,consts:[[3,"translucent"],[1,"ion-padding-landscape-head"],["slot","start"],["text","","icon","caret-back","defaultHref","tabs/transaction-type-config"],["slot","end"],[4,"ngIf"],["color","light",1,"ion-padding",3,"fullscreen"],["class","ion-padding-landscape-small background-color-white padding-2",4,"ngIf"],["color","medium","fill","outline",3,"click"],["color","primary",3,"fill","click"],[1,"ion-padding-landscape-small","background-color-white","padding-2"],["class","ion-text-center",4,"ngIf"],[1,"margin-top-1",3,"size"],["mode","md","label","Nombre de Transacci\xf3n","label-placement","floating","fill","outline","placeholder","Ingresa el nombre de la transacci\xf3n",3,"ngModel","clearInput","ionInput","ngModelChange"],[1,"align-content-center",3,"size","ngClass"],[3,"ngModel","checked","ngModelChange"],[1,"ion-text-center"],["size","12",1,"ion-text-end","margin-top-1"],["color","primary","fill","clear","size","small",1,"btn-add",3,"click"],["name","add-circle-outline"],["size","12"],[1,"table"],[1,"row-head","background-color-light-blue"],["class","row-body",3,"ngClass",4,"ngFor","ngForOf"],["class","row-body  ion-text-center",4,"ngIf"],[1,"row-body",3,"ngClass"],["size","5"],["size","7"],["mode","md","placeholder","Nombre categor\xeda",1,"input-name",3,"ngModel","input","ngModelChange"],["mode","md","appAllowNegativeInput","","placeholder","0","type","number",1,"input-price",3,"ngModel","input","ngModelChange"],["size","5",1,"margin-02"],["mode","md","placeholder","0","appAllowNegativeInput","","type","number",1,"input-price",3,"ngModel","input","ngModelChange"],[1,"row-body","ion-text-center"],["span","3"]],template:function(i,o){1&i&&(t.TgZ(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-buttons",2),t._UZ(3,"ion-back-button",3),t.qZA(),t._UZ(4,"ion-title"),t.TgZ(5,"ion-buttons",4),t.YNc(6,P,5,1,"ng-container",5),t._UZ(7,"ion-menu-button"),t.qZA()()(),t.TgZ(8,"ion-content",6),t.YNc(9,L,10,12,"ion-grid",7),t.qZA()),2&i&&(t.Q6J("translucent",!0),t.xp6(6),t.Q6J("ngIf","Add"==o.action||"Modify"==o.action),t.xp6(2),t.Q6J("fullscreen",!0),t.xp6(1),t.Q6J("ngIf",o.transactionType))},dependencies:[h.mk,h.sg,h.O5,T.Fj,T.wV,T.JJ,T.On,r.oU,r.YG,r.Sm,r.wI,r.W2,r.jY,r.Gu,r.gu,r.pK,r.fG,r.Nd,r.wd,r.ho,r.sr,r.w,r.j9,r.cs,A],styles:['.btn-add[_ngcontent-%COMP%]{margin-top:-.7rem}ion-input[_ngcontent-%COMP%], ion-input[_ngcontent-%COMP%]::part("native"){--padding-start: 1rem}.table[_ngcontent-%COMP%]   .row-body[_ngcontent-%COMP%]:last-child{border-bottom:1px solid gray;border-bottom-right-radius:12px;border-bottom-left-radius:12px}.row-head[_ngcontent-%COMP%]{border:1px solid gray;border-top-right-radius:12px;border-top-left-radius:12px;background-color:#d3d3d3;height:2rem;text-align:center;font-weight:700}.row-head[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]{height:.5rem}.row-body[_ngcontent-%COMP%]{justify-content:center;border-left:1px solid gray;border-right:1px solid gray}.table[_ngcontent-%COMP%]   .row-body[_ngcontent-%COMP%]:last-child{padding-bottom:17px}.table[_ngcontent-%COMP%]   .row-body[_ngcontent-%COMP%]:first-child{padding-top:10px}.input-price[_ngcontent-%COMP%], .input-name[_ngcontent-%COMP%]{width:98%;text-align:center;height:2rem}']})}return e})()}];let G=(()=>{class e{static#t=this.\u0275fac=function(i){return new(i||e)};static#n=this.\u0275mod=t.oAB({type:e});static#e=this.\u0275inj=t.cJS({imports:[m.Bz.forChild(O),m.Bz]})}return e})(),K=(()=>{class e{static#t=this.\u0275fac=function(i){return new(i||e)};static#n=this.\u0275mod=t.oAB({type:e});static#e=this.\u0275inj=t.cJS({imports:[h.ez,T.u5,r.Pc,G]})}return e})()}}]);